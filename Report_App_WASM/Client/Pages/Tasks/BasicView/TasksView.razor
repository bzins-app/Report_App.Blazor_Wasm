@page "/TasksView/{ProviderName}/{DataProviderId:int}"
@inject NavigationManager UriHelper
@attribute [Authorize]

<PageTitle>@Localizer.Get("Base view")</PageTitle>

<ErrorBoundary>
    <ChildContent>
        <MudTabs Outlined="true" Position="Position.Top" Rounded="true" Border="true" Elevation="6"
                 ApplyEffectsToContainer="true">
            <MudTabPanel Text="@Localizer.Get("Run reports manually")">
                <_Reports DataProviderId="@DataProviderId" ProviderName="@ProviderName"/>
            </MudTabPanel>
            <MudTabPanel Text="@Localizer.Get("Retrieve files")">
                <_RetrieveFiles DataProviderId="@DataProviderId" ProviderName="@ProviderName"/>
            </MudTabPanel>
        </MudTabs>
    </ChildContent>
</ErrorBoundary>

@code
{
    [Parameter] public int DataProviderId { get; set; }

    [Parameter] public string? ProviderName { get; set; }

    [CascadingParameter] private Task<AuthenticationState> AuthenticationStateTask { get; set; } = default!;

    protected override async Task OnParametersSetAsync()
    {
        var user = (await AuthenticationStateTask).User;
        if (!user.IsInRole(ProviderName!) && !user.IsInRole("Admin"))
        {
            UriHelper.NavigateTo("/403");
        }
    }


}