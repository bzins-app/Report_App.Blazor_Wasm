@using ApexCharts

@if (logs == null)
{
    <MudProgressLinear Color="MudBlazor.Color.Primary" Indeterminate="true" Class="my-7" />
}
else
{
<ApexChart TItem="EmailsLogsalues"
		   Title="@localizer.Get("Emails")"
		   XAxisType="XAxisType.Datetime" Height="@Height"
		   Options="options" @ref="chart">

	<ApexPointSeries TItem="EmailsLogsalues"
				Items="logs"
				Name="@localizer.Get("Nbr of jobs")"
				SeriesType="SeriesType.Bar"
				XValue="@(e => e.Date.ToLocalTime())"
					 YAggregate="@(e => e.Sum(a=>a.NbrEmails))"
				OrderBy="e=>e.X" />
	<ApexPointSeries TItem="EmailsLogsalues"
				Items="logs"
				Name="@localizer.Get("Nbr of errors")"
				SeriesType="SeriesType.Bar"
				XValue="@(e => e.Date.ToLocalTime())"
				YAggregate="@(e => e.Sum(a=>a.NbrErrors))"
				OrderBy="e=>e.X" />

	<ApexPointSeries TItem="EmailsLogsalues"
				Items="logs"
				Name="@localizer.Get("Job duration")"
				SeriesType="SeriesType.Bar"
				XValue="@(e => e.Date.ToLocalTime())"
					 YAggregate="@(e => e.Sum(a=>a.TotalDuration/60))"
				OrderBy="e=>e.X" />

</ApexChart>
}


@code {

	[Parameter] public string Height { get; set; } = null;
	private List<EmailsLogsalues>? logs;
	private ApexChartOptions<EmailsLogsalues> options = new ApexChartOptions<EmailsLogsalues>();
	private ApexChart<EmailsLogsalues> chart;

	 protected override async Task OnInitializedAsync()
	{
		logs = await dataService.GetValues<EmailsLogsalues>("EmailLogs", "api/Dashboard/");
		options.Chart.Stacked = true;
		options.Tooltip = new Tooltip { X = new TooltipX { Format = @"dd \ MM \ yyyy" } };
		options.Theme = new Theme { Palette = PaletteType.Palette3};
		options.Colors = new List<string> { "#008FFB", "#FF4560", "#FEB019" };
		//Stacked 100% test
		//options.Chart = new Chart { Stacked = true, Type = ChartType.Bar, StackType = StackType.Percent100 };
		options.Chart.Toolbar = new Toolbar { Show = false };		
	}
}
