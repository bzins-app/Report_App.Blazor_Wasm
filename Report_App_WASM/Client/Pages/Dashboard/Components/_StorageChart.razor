@using ApexCharts

@if (_logs == null)
{
    <MudProgressLinear Color="MudBlazor.Color.Primary" Indeterminate="true" Class="my-7" />
}
else
{
    <ApexChart TItem="ApplicationLogReportResultDTO"
           Title="@(Localizer.Get("Storage per report")+":"+Localizer.Get("Total size in MB"))"
           Height="@Height"
           Options="_options"
           @ref=_chart>

        <ApexPointSeries TItem="ApplicationLogReportResultDTO"
                     Items="_logs"
                     Name="@Localizer.Get("Total size in MB")"
                     SeriesType="SeriesType.Treemap"
                     XValue="@(e => e.ReportName)"
                     YAggregate="@(e => (decimal)e.Sum(a=>Math.Round( a.FileSizeInMB,2)))" OrderByDescending="@(e=>e.Y)"/>
    </ApexChart>
}



@code {
    [Parameter] public string Height { get; set; } = null;
    private double _sizeFilesStoredLocally;
    private int _nbrOfFilesStored;

    private List<ApplicationLogReportResultDTO>? _logs;
    private ApexChartOptions<ApplicationLogReportResultDTO> _options = new ApexChartOptions<ApplicationLogReportResultDTO>();
    private ApexChart<ApplicationLogReportResultDTO> _chart;

    protected override async Task OnInitializedAsync()
    {
        _logs = await DataService.GetValues<ApplicationLogReportResultDTO>("StorageInfo", "api/Dashboard/");
    }
}