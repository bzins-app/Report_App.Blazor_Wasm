@*@using Report_App_BlazorServ.Pages.UserAccount
@using Microsoft.AspNetCore.Identity
@inject UserManager<ApplicationUser> _userManager

<MudDialog>
    <TitleContent>
        <MudText Typo="Typo.h6">
            <MudIcon Icon="@(Action==CrudAction.Update? Icons.Material.Filled.Edit:Action==CrudAction.Create?Icons.Material.Filled.Create:Icons.Material.Filled.DeleteForever )" Class="mr-3 mb-n1" />
            @localizer.Get(Action == CrudAction.Update ? "Edit" : Action == CrudAction.Create ? "Add" : "Delete")
        </MudText>
    </TitleContent>
    <DialogContent>
        <MudForm Model="@model" @ref="@form" Validation="@(userValidator.ValidateValue)" >
            <MudTextField @bind-Value="model.UserName" Label="@localizer.Get("Name")" For="@(()=>model.UserName)" Disabled="Action==CrudAction.Create?false:true" />
            <MudTextField @bind-Value="model.Email" Label="@localizer.Get("Email")" For="@(()=>model.Email)" InputType="InputType.Email" Disabled="Action==CrudAction.Create?false:true" />
            <MudTextField @bind-Value="model.Password" Label="@localizer.Get("Password")" For="@(()=>model.Password)" InputType="InputType.Password" Disabled="Action==CrudAction.Create?false:true" />
            <MudTextField @bind-Value="model.ConfirmPassword" Label="@localizer.Get("Confirm Password")" For="@(()=>model.ConfirmPassword)" InputType="InputType.Password" Disabled="Action==CrudAction.Create?false:true" />
        </MudForm>
        @if (Action == CrudAction.Delete)
        {
                <MudTextField @bind-Value="deletionValidation" Label="@(localizer.Get("Confirm the deletion by entering")+": Validate")" Required RequiredError="@localizer.Get("Required")" />
        }
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Info" OnClick="Cancel">@localizer.Get("Cancel")</MudButton>
        <MudButton Color="Action==CrudAction.Delete?Color.Error:Color.Primary" OnClick="Validate">@localizer.Get(Action==CrudAction.Delete?"Delete":"Validate")</MudButton>
    </DialogActions>
</MudDialog>
@code {
    [CascadingParameter] MudDialogInstance MudDialog { get; set; }

    [Parameter] public ApplicationUser Item { get; set; }
    [Parameter] public CrudAction Action { get; set; }
    private MudForm form = default!;
    private UserFormModel model { get; set; } = new();
    private string deletionValidation;
    private UserFormModelValidator userValidator ;

    protected override void OnParametersSet()
    {
        userValidator = new(localizer);
        base.OnParametersSet();
    }

    protected override void OnInitialized()
    {
        model.Options = _userManager.Options;
        model.UserName = Item.UserName;
        model.Id = Item.Id;
        model.Email = Item.Email;
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private async Task Validate()
    {
        if (Action == CrudAction.Delete)
        {
            if (deletionValidation == "Validate")
            {
                MudDialog.Close(DialogResult.Ok(Item));
            }
        }
        else
        {
            await form.Validate();
            if (form.IsValid)
            {
                Item.Email = model.Email;
                Item.UserName = model.UserName;
                Item.PasswordHash = model.Password;
                Item.Email = model.Email;
                MudDialog.Close(DialogResult.Ok(Item));
            }
        }
    }
}*@